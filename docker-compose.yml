version: '3'
services:
    navplan_persistence:
        build:
            context: ./navplan_persistence
        container_name: navplan_persistence
        environment:
            MARIADB_ROOT_PASSWORD_FILE: /run/secrets/db_root_pw
            MARIADB_USER_FILE: /run/secrets/db_navplan_user
            MARIADB_PASSWORD_FILE: /run/secrets/db_navplan_pw
        secrets:
            - db_root_pw
            - db_navplan_user
            - db_navplan_pw
        ports:
            - "3306:3306"

    navplan_backend:
        build:
            context: ./navplan_backend
        container_name: navplan_backend
        ports:
            - "8080:80"
        depends_on:
            - navplan_persistence

#  navplan_frontend:
#    build:
#      context: ./navplan_frontend
#    container_name: navplan_frontend
#    ports:
#      - "4200:4200"

secrets:
    db_root_pw:
        file: ./secrets/db_root_pw.txt
    db_navplan_user:
        file: ./secrets/db_navplan_user.txt
    db_navplan_pw:
        file: ./secrets/db_navplan_pw.txt
